{"version":3,"sources":["webpack:///./src/components/lostTons/Common.vue?5e78","webpack:///./src/api/lostTons.js","webpack:///./src/components/lostTons/Common.vue?17a9","webpack:///./src/components/lostTons/Chart.vue","webpack:///src/components/dailyTransactionsCount/Chart.vue","webpack:///./src/components/lostTons/Chart.vue?4dcf","webpack:///src/components/lostTons/Common.vue","webpack:///./src/components/lostTons/Common.vue?654e","webpack:///./src/components/lostTons/Common.vue","webpack:///./node_modules/comma-number/index.js"],"names":["require","client","utils","commaNumber","makeQuery","query","index","lt","now","oneWeek","gt","lostTons","volumes","labels","net","response","result","data","Object","entries","key","value","push","Math","round","oneTon","timestamp","split","dt","Date","toLocaleDateString","datasets","label","backgroundColor","console","log","lostTonsSum","aggregateAccounts","totalAccountsCount","lostTonsAccounts","accounts","map","v","id","balance","module","exports","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","chartData","directives","name","rawName","expression","_v","_s","totalAmount","totalAccounts","items","staticRenderFns","extends","mixins","reactiveProp","options","responsive","maintainAspectRatio","legend","component","loading_graphic","loading_table","components","chart","inputNumber","optionalSeparator","optionalDecimalChar","decimalChar","stringNumber","number","length","Number","replace","String","isInteger","isNaN","isFinite","decimalIndex","lastIndexOf","decimal","slice","parts","parse","join","string","separator","i","strings","substr","bindWith"],"mappings":"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","file":"js/chunk-3f722356.46ffda53.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Common.vue?vue&type=style&index=0&id=309fa4bc&scoped=true&lang=css&\"","const { client } = require(\"./client/webClient\");\nconst utils = require(\"./utils\");\nconst commaNumber = require('comma-number');\n\nfunction makeQuery() {\n    let query = '{';\n    for (let index = 30; index >= 0; index--) {\n        let lt = utils.now - index * utils.oneWeek;\n        let gt = lt - utils.oneWeek;\n        query += `      \n        data_${lt}: aggregateAccounts(\n            filter:{      \n              acc_type: {\n                ne: 1\n              }\n              last_paid:{\n                gt: ${gt}  lt: ${lt}\n              }\n            }\n            fields:[\n              {field: \"balance\", fn: SUM}\n            ]\n          )         \n          `;\n    }\n    query += '}';\n    return query;\n}\n\nconst lostTons = async () => {\n    let volumes = [];\n    let labels = [];\n\n    try {\n        let response = (await client.net.query({ \"query\": makeQuery() })).result.data;\n        for (const [key, value] of Object.entries(response)) {\n            volumes.push(Math.round(value[0] / utils.oneTon));\n            let timestamp = key.split(\"_\")[1];\n            let dt = new Date(timestamp * 1000).toLocaleDateString(\"ru-RU\");\n            labels.push(dt);\n        }\n        return {\n            datasets: [\n                {\n                    label: \"Lost tons\",\n                    backgroundColor: \"lightgray\",\n                    data: volumes,\n                },\n            ],\n            labels\n        };\n    } catch (e) {\n        console.log(e);\n    }\n}\n\nconst lostTonsSum = async () => {\n    try {\n        let response = (await client.net.query({\n            \"query\": `        \n            {aggregateAccounts(\n            filter:{      \n              acc_type: {\n                ne: 1\n              }              \n            }\n            fields:[\n              {field: \"balance\", fn: SUM}\n            ]\n          )}\n        ` })).result.data.aggregateAccounts[0];\n        return commaNumber(Math.round(response / utils.oneTon));\n    } catch (e) {\n        console.log(e);\n    }\n}\n\nconst totalAccountsCount = async () => {\n    try {\n        return (await client.net.query({\n            \"query\": `        \n            {aggregateAccounts(\n            filter:{      \n              acc_type: {\n                ne: 1\n              }              \n            }\n            fields:[\n              {field: \"balance\", fn: COUNT}\n            ]\n          )}\n        ` })).result.data.aggregateAccounts[0];\n    } catch (e) {\n        console.log(e);\n    }\n}\n\nconst lostTonsAccounts = async () => {\n    try {\n        let response = (await client.net.query({\n            \"query\": `        \n        query{\n            accounts(filter:{\n              acc_type:{\n                ne: 1\n              }\n            }\n            orderBy:{\n              path: \"balance\",\n              direction: DESC\n            }){\n              id\n              balance(format:DEC)\n            }\n          }          \n        ` })).result.data.accounts;\n        return response.map((v) => {\n            return {\n                'Address': v.id,\n                'Balance': `${commaNumber(Math.round(v.balance / utils.oneTon))} tons`\n            }\n        });\n    } catch (e) {\n        console.log(e);\n    }\n}\n\nmodule.exports = {\n    lostTons,\n    lostTonsSum,\n    lostTonsAccounts,\n    totalAccountsCount\n}\n//lostTons();","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center\",attrs:{\"id\":\"buttons\"}},[_c('div',[_c('chart',{attrs:{\"chart-data\":_vm.chartData}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.loading_graphic),expression:\"loading_graphic\"}],staticClass:\"h3 text-info\"},[_vm._v(\"Data loading ...\")])],1),_c('div',{staticClass:\"text-center h5 mt-4\"},[_vm._v(_vm._s(_vm.totalAmount))]),_c('div',{staticClass:\"text-center h5 mt-4\"},[_vm._v(_vm._s(_vm.totalAccounts))]),_c('b-table',{attrs:{\"fixed\":\"\",\"striped\":\"\",\"hover\":\"\",\"items\":_vm.items}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render, staticRenderFns\nimport script from \"./Chart.vue?vue&type=script&lang=js&\"\nexport * from \"./Chart.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<script>\nimport { Line, mixins } from \"vue-chartjs\";\nconst { reactiveProp } = mixins;\n\nexport default {\n  extends: Line,\n  mixins: [reactiveProp],\n  data() {\n    return {\n      options: {\n        responsive: true,\n        maintainAspectRatio: false,\n        legend: {           \n          labels: {                          \n              fontSize: 25,            \n          },\n        },\n      },\n    };\n  },\n  async mounted() {\n    this.renderChart(this.chartData, this.options);\n  },\n};\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chart.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chart.vue?vue&type=script&lang=js&\"","<template>\n  <div id=\"buttons\" class=\"text-center\">\n    <div>\n      <chart :chart-data=\"chartData\" />\n      <div class=\"h3 text-info\" v-show=\"loading_graphic\">Data loading ...</div>\n    </div>       \n    <div class=\"text-center h5 mt-4\">{{totalAmount}}</div>\n    <div class=\"text-center h5 mt-4\">{{totalAccounts}}</div>\n     <b-table fixed striped hover :items=\"items\"></b-table>\n  </div>\n</template>\n<script>\nimport chart from \"./Chart.vue\";\nimport {lostTons, lostTonsSum, lostTonsAccounts, totalAccountsCount} from \"../../api/lostTons\";\n\nexport default {\n  data() {\n    return {\n      chartData: null,\n      loading_graphic: true,\n      loading_table: true,\n      totalAmount: null,\n      totalAccounts: null\n    };\n  },\n  components: {\n    chart,\n  },\n   mounted() {\n    lostTons().then((r)=>{     \n     this.chartData = r;\n     this.loading_graphic= false;\n    });     \n    lostTonsSum().then((r)=>{     \n     this.totalAmount = `Total amount: ${r} tons`;     \n    });  \n    lostTonsAccounts().then((r)=>{     \n     this.items = r;     \n    }); \n    totalAccountsCount().then((r)=>{     \n     this.totalAccounts = `Total accounts: ${r}`;     \n    });        \n  },\n};\n</script>\n<style scoped>\n#buttons span {\n  margin-right: 1rem;\n  margin-left: 1rem;\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Common.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Common.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Common.vue?vue&type=template&id=309fa4bc&scoped=true&\"\nimport script from \"./Common.vue?vue&type=script&lang=js&\"\nexport * from \"./Common.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Common.vue?vue&type=style&index=0&id=309fa4bc&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"309fa4bc\",\n  null\n  \n)\n\nexport default component.exports","'use strict'\n\n// return a string with the provided number formatted with commas.\n// can specify either a Number or a String.\nfunction commaNumber(inputNumber, optionalSeparator, optionalDecimalChar) {\n\n  // default `decimalChar` is a period\n  const decimalChar = optionalDecimalChar || '.'\n\n  let stringNumber // we assign this in the switch block and need it later.\n\n  {\n    let number // we assign this in the switch block and need it right after.\n\n    switch (typeof inputNumber) {\n\n      case 'string':\n\n        // if there aren't enough digits to need separators then return it\n        // NOTE: some numbers which are too small will get passed this\n        //       when they have decimal values which make them too long here.\n        //       but, the number value check after this switch will catch it.\n        if (inputNumber.length < (inputNumber[0] === '-' ? 5 : 4)) {\n          return inputNumber\n        }\n\n        // remember it as a string in `stringNumber` and convert to a Number\n        stringNumber = inputNumber\n\n        // if they're not using the Node standard decimal char then replace it\n        // before converting.\n        number = Number(\n          (decimalChar !== '.') ? stringNumber.replace(decimalChar, '.') : stringNumber\n        )\n        break\n\n      // convert to a string.\n      // NOTE: don't check if the number is too small before converting\n      //       because we'll need to return `stringNumber` anyway.\n      case 'number':\n        stringNumber = String(inputNumber)\n        number       = inputNumber\n        // create the string version with the decimalChar they specified.\n        // this matches what the above case 'string' produces,\n        // and, fixes the bug *not* doing this caused.\n        if ('.' !== decimalChar && !Number.isInteger(inputNumber)) {\n          stringNumber = stringNumber.replace('.', decimalChar)\n        }\n        break\n\n      // return invalid type as-is\n      default: return inputNumber\n    }\n\n    // when it doesn't need a separator or isn't a number then return it\n    if ((-1000 < number && number < 1000) || isNaN(number) || !isFinite(number)) {\n      return stringNumber\n    }\n  }\n\n  {\n    // strip off decimal value to add back in later\n    const decimalIndex = stringNumber.lastIndexOf(decimalChar)\n    let decimal\n    if (decimalIndex > -1) {\n      decimal = stringNumber.slice(decimalIndex)\n      stringNumber = stringNumber.slice(0, decimalIndex)\n    }\n\n    // finally, parse the string. Note, default 'separator' is a comma.\n    const parts = parse(stringNumber, optionalSeparator || ',')\n\n    // if there's a decimal value then add it to the parts.\n    if (decimal) {// NOTE: we sliced() it off including the decimalChar\n      parts.push(decimal)\n    }\n\n    // combine all parts for the final string (note, has separators).\n    return parts.join('')\n  }\n}\n\nfunction parse(string, separator) {\n\n  // find first index to split the string at (where 1st separator goes).\n  let i = ((string.length - 1) % 3) + 1\n\n  // above calculation is wrong when num is negative and a certain size.\n  if (i === 1 && (string[0] === '-')) {\n    i = 4  // example: -123,456,789  start at 4, not 1.\n  }\n\n  const strings = [ // holds the string parts\n    string.slice(0, i) // grab part before the first separator\n  ]\n\n  // split remaining string in groups of 3 where a separator belongs\n  for (; i < string.length; i += 3) {\n    strings.push(separator, string.substr(i, 3))\n  }\n\n  return strings\n}\n\n\n// convenience function for currying style:\n//   const format = commaNumber.bindWith(',', '.')\nfunction bindWith(separator, decimalChar) {\n  return function(number) {\n    return commaNumber(number, separator, decimalChar)\n  }\n}\n\nmodule.exports = commaNumber\nmodule.exports.bindWith = bindWith\n"],"sourceRoot":""}